#!/usr/bin/env bash
# Python wrapper for this repo (prevents import/path footguns).
#
# - Adds repo root + `packages/` to PYTHONPATH
# - Loads `.env` if present (fail-soft)
# - Disables `__pycache__` noise by default
#
# Examples:
#   ./scripts/py -c "import factory_common; print('ok')"
#   ./scripts/py - <<'PY'
#   from packages.script_pipeline.tools import semantic_alignment
#   print(semantic_alignment.__file__)
#   PY
set -euo pipefail

ROOT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"

export PYTHONPATH="$ROOT_DIR:$ROOT_DIR/packages"
export PYTHONDONTWRITEBYTECODE="${PYTHONDONTWRITEBYTECODE:-1}"

ENV_FILE="$ROOT_DIR/.env"
if [[ -f "$ENV_FILE" ]]; then
  # shellcheck disable=SC1090
  set -a
  source "$ENV_FILE"
  set +a
fi

exec python3 "$@"

