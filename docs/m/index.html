<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Mobile Start</title>
    <link rel="stylesheet" href="../styles.css?v=20260118_03" />
    <style>
      .start-card {
        border: 1px solid var(--border);
        background: rgba(15, 23, 48, 0.72);
        border-radius: 14px;
        padding: 14px;
      }
      .start-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 10px;
      }
      .start-actions {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 10px;
      }
      .start-actions .btn {
        font-size: 14px;
        padding: 12px 14px;
        border-radius: 12px;
      }
      .start-input {
        width: 100%;
        border: 1px solid var(--border);
        background: rgba(17, 26, 51, 0.55);
        color: var(--text);
        border-radius: 12px;
        padding: 12px 14px;
        font-size: 16px;
        outline: none;
      }
    </style>
  </head>
  <body>
    <div class="app">
      <section class="start-card">
        <h1 style="margin: 0 0 6px 0">Mobile Start</h1>
        <div class="muted">
          このURLをブックマーク: <code>/m/</code>（スマホ用の入口）
        </div>
      </section>

      <section class="start-card start-grid" aria-label="主要ページ">
        <div>
          <div style="font-weight: 700; margin-bottom: 6px">最初に開く</div>
          <div class="muted">台本・サムネ・動画内画像を、エピソード単位で迷わず見たい</div>
          <div class="start-actions">
            <a class="btn btn--primary" href="../ep/">エピソード一覧（推奨）</a>
            <a class="btn btn--ghost" href="../snapshot/">企画/進捗（snapshot）</a>
            <a class="btn btn--ghost" href="../guide/">Guide（全体像/運用）</a>
          </div>
        </div>

        <div>
          <div style="font-weight: 700; margin-bottom: 6px">検索したい</div>
          <div class="muted">台本を検索してコピーしたい（Script Viewer）</div>
          <div class="start-actions">
            <a class="btn btn--ghost" href="../">Script Viewer</a>
            <a class="btn btn--ghost" href="../archive/">書庫（Releases）</a>
          </div>
        </div>

        <div>
          <div style="font-weight: 700; margin-bottom: 6px">直リンクで開く</div>
          <div class="muted">例: <code>CH27-030</code></div>
          <form id="jumpForm" style="margin-top: 10px">
            <input id="jumpInput" class="start-input" inputmode="text" autocomplete="off" placeholder="CH27-030" />
            <div class="start-actions">
              <button class="btn btn--primary" type="submit">開く</button>
              <span id="jumpStatus" class="muted"></span>
            </div>
          </form>
        </div>
      </section>
    </div>

    <script>
      (function () {
        const form = document.getElementById("jumpForm");
        const input = document.getElementById("jumpInput");
        const status = document.getElementById("jumpStatus");
        if (!form || !input) return;

        function normalizeChannel(raw) {
          const m = String(raw || "")
            .trim()
            .toUpperCase()
            .match(/^CH(\\d{1,2})$/);
          if (!m) return "";
          return `CH${String(parseInt(m[1], 10)).padStart(2, "0")}`;
        }

        function normalizeVideo(raw) {
          const s = String(raw || "").trim();
          if (!/^\\d{1,3}$/.test(s)) return "";
          return String(parseInt(s, 10)).padStart(3, "0");
        }

        form.addEventListener("submit", (ev) => {
          ev.preventDefault();
          if (status) status.textContent = "";
          const raw = String(input.value || "").trim();
          const m = raw.toUpperCase().match(/^CH(\\d{1,2})[-_ ]?(\\d{1,3})$/);
          if (!m) {
            if (status) status.textContent = "形式: CHxx-NNN（例: CH27-030）";
            return;
          }
          const ch = normalizeChannel(`CH${m[1]}`);
          const vv = normalizeVideo(m[2]);
          if (!ch || !vv) {
            if (status) status.textContent = "形式: CHxx-NNN（例: CH27-030）";
            return;
          }
          window.location.href = `../ep/${ch}/${vv}/`;
        });
      })();
    </script>
  </body>
</html>
