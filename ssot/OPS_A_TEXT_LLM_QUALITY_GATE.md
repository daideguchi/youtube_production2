# OPS_A_TEXT_LLM_QUALITY_GATE — LLM審査（Judge）+ 微修正（Fixer）で台本品質を安定させる（SSOT）

目的:
- 「文字数だけ満たす最低品質」を **構造的に防止**する。
- Aテキスト（AIナレーション用の読み台本）が **狙い通り・自然・冗長なし** であることを、機械判定ではなく **推論モデルの判定**で担保する。

適用範囲（強制）:
- 全チャンネル / 全エピソードの `script_validation`（品質ゲート）に適用する。
- 台本本文（Aテキスト）SoT:
  - `workspaces/scripts/{CH}/{NNN}/content/assembled_human.md`（存在する場合の正本）
  - それ以外は `content/assembled.md`

関連（正本）:
- 全チャンネル共通の書式/禁則: `ssot/OPS_A_TEXT_GLOBAL_RULES.md`
- パイプライン確定フロー: `ssot/OPS_CONFIRMED_PIPELINE_FLOW.md`

---

## 1) 基本方針（2段階のLLM操作）

### 1.1 Judge（審査）
- 入力: チャンネル情報（persona / channel prompt / planning meta）+ Aテキスト本文 + 全チャンネル共通ルール（SSOT）
- 出力: **JSONのみ**（合否 + 指摘 + 最小修正方針）
- 役割: 台本が「視聴者にストレスなく伝わる」水準に達しているかを **推論で判定**する。

### 1.2 Fixer（微修正）
- 入力: Judge のJSON指摘 + 同じ文脈情報 + Aテキスト本文
- 出力: **修正版の台本本文のみ**（説明禁止）
- 役割: Judge 指摘に従い、必要最小限の加除修正で品質を上げる。
  - ただし「水増し回避」を最優先し、厚みは **具体の追加**で作る。
  - 機械的な等間隔の `---` 挿入は禁止（文脈ベース）。

---

## 2) Judge の必須チェック項目（合否の根拠）

Judge は次を **機械的ルールではなく文脈理解**で判定する。

- 流れ/接続: 唐突な段落・急な別話題・終盤の不自然な例の追加がないか
- 水増し検出: 同趣旨の言い換え連打、空疎な一般論、淡々とした繰り返しがないか
- 具体の質: 具体例が “説明の代わりの穴埋め” になっていないか（数だけ増やしていないか）
- 狙いの一貫性: planning（タイトル/企画意図/キーコンセプト）とズレていないか
- チャンネル指針: persona / script_prompt の要求（構成要素・トーン）が満たされているか
- 読み上げ適性: 句の長さ、息継ぎ、`---` の使い方、`「」`/`（）` の過剰使用がないか
- “GPT臭”の抑制: 不自然に硬い比喩、メタ的な言い回し、作り物感の強い文がないか
- 事実リスク: 根拠のない数値/研究/固有名詞の断定など、信頼を壊す危険がないか

合否:
- `pass`: そのまま音声生成に進める
- `fail`: Fixer による修正が必須（台本本文の書き直し/差し替えが発生する）

---

## 3) Fixer の修正原則（品質と安全）

- **核の維持**: 既存台本の「伝えたいこと」と中心エピソードは基本的に保持（ただし、核自体が弱い場合は Judge 指示に従い組み替え可）。
- **深く狭く**: 余計な話題を増やさず、主題の理解が深まる具体（状況・行動・心の動き・結果）を追加する。
- **例は厳選**: 人物例/エピソードの “連打” は避け、必要最小限で効果が出る配置にする。
- **禁則順守**: `ssot/OPS_A_TEXT_GLOBAL_RULES.md` の禁止事項を必ず守る（`---` 以外の区切り、URL/脚注/箇条書き等）。
- **文字数維持**: チャンネルの `target_chars_min/max` を厳守。削るだけで足りなくなる場合は、空疎な文を足さず “理解が増える具体” を足す。

---

## 4) 失敗時の扱い（止め方）

- Fixer を最大N回回しても Judge が `pass` を返さない場合:
  - `script_validation` は `pending` に留め、`status.json` に Judge の指摘と最小修正方針を記録する。
  - 人間が `assembled_human.md`（なければ `assembled.md`）を手で直し、再実行する。

注:
- URL/脚注/箇条書き/区切り記号などの **ハード禁則**は、従来どおり機械バリデータで検出して停止してよい（フロー品質の合否とは別）。

