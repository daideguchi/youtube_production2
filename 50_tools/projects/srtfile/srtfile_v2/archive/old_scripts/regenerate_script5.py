#!/usr/bin/env python3
"""台本5再生成: 呼吸法とプラーナ（6500字目標）"""

import os
import re
import google.generativeai as genai

# Gemini設定
genai.configure(api_key=os.getenv('GEMINI_API_KEY'))
model = genai.GenerativeModel('gemini-2.5-pro')

# 超厳格な形式指示（文字数強調）
strict_format = '''
【絶対遵守】出力形式の厳守:

【ルール1】1行は必ず27文字以内（これを超えたら即エラー）
【ルール2】1セクションは必ず1行または2行のみ（3行以上は絶対禁止）
【ルール3】セクション終わりに必ず「///」
【ルール4】前置き・見出し・箇条書き一切禁止
【ルール5】最初の行からすぐに台本本文を開始すること
【ルール6】括弧 () （） を一切使わないこと
【ルール7】読点は適度に使用（少なめ・1行に最大2個まで）
【ルール8】総文字数は必ず6500字以上（厳守・これが最重要）

【文字数確保の方法】:
- 各セクションで十分に詳しく解説する
- 具体例を豊富に盛り込む
- 比喩や問いかけを効果的に使う
- 7つのセクション全てを丁寧に展開
- セクション3と4は特に長めに（各1500字程度）

【良い例（詳細な解説）】:
呼吸を
意識したことがありますか？///

ただ息をしているだけ。
多くの人がそう思っています。///

しかしそれは、あなたの内なる力の
ほんの一部しか見ていません。///

呼吸は単なる生命維持活動ではなく
魂と宇宙をつなぐ神秘の架け橋です。///

【目標文字数】: 6500-7000字を厳守してください
'''

# プロンプト読み込み
with open('scripts/アカシック台本プロンプト', 'r', encoding='utf-8') as f:
    base_prompt = f.read()

# テーマ指示（詳細版・文字数強調）
theme = '''
【台本5: 呼吸法とプラーナ - 宇宙エネルギーとの繋がり】（目標6500字以上）

このテーマで、古代の叡智とアカシックレコードの視点から呼吸法とプラーナについて解説する台本を作成してください。

【重要】各セクションで十分に詳しく書いてください。短くまとめないでください。

【セクション1: 導入】（目標800字）
- 呼吸への気づき（普段は無意識）
- 呼吸は単なる空気交換ではない
- 宇宙エネルギー「プラーナ」との繋がり
- この動画で得られる変容
- 視聴の呼びかけ

【セクション2: 核心概念】（目標900字）
- プラーナの正確な定義
- 呼吸と生命エネルギーの関係
- 古代ヨガの叡智
- 心と呼吸の連動性
- アカシックレコードの視点

【セクション3: 深掘り - 呼吸法の種類と効果】（目標1500字・最重要）
- 3つの基本呼吸法を詳しく解説:
  1. 腹式呼吸 - 詳しいやり方と効果（具体例3つ以上）
  2. 胸式呼吸 - 詳しいやり方と効果（具体例3つ以上）
  3. 完全呼吸 - 詳しいやり方と効果（具体例2つ以上）
- それぞれの呼吸法がどう作用するか
- 呼吸と感情の関係性
- 科学的根拠（酸素・二酸化炭素・自律神経）

【セクション4: 実践方法 - プラーナヤーマ】（目標1500字・最重要）
- プラーナヤーマの3つの実践:
  1. ナディショーダナ - 詳しいステップ（具体例）
  2. カパーラバーティ - 詳しいステップ（具体例）
  3. ウジャイ呼吸 - 詳しいステップ（具体例）
- 日常での実践タイミング
- 初心者向けの始め方
- やってはいけないNG行動

【セクション5: 課題への対処】（目標800字）
- うまくいかない時の対処法
- 呼吸が浅い人への具体的アドバイス
- 続かない時のモチベーション維持
- 高次の視点からの解釈
- 失敗からの学び

【セクション6: 究極の目的】（目標900字）
- 真の呼吸法の目的
- 魂と宇宙の一体化
- 悟りへの道
- プラーナと意識の覚醒
- 人生を変える呼吸の力

【セクション7: 結論】（目標700字）
- 全体のまとめ
- 今日から始められること
- 行動喚起
- 励ましのメッセージ
- 視聴者への感謝

【文章の質】:
- 抽象的な説明だけでなく、必ず具体例を豊富に
- 視聴者が実践できる具体的な方法
- 深い洞察と希望を与える内容
- わかりやすく、心に響く表現

【絶対に守ること】:
- 短くまとめない
- 各セクションで十分に詳しく書く
- 具体例を豊富に盛り込む
- 最終的に6500字以上を確保
'''

print('🧠 Gemini 2.5 Pro: 台本5再生成開始（6500字目標）...')
response = model.generate_content(strict_format + base_prompt + theme)

# 前処理（メタコメント・見出し削除）
content = response.text
content = re.sub(r'^.*?[\n]*(呼吸|あなた|もし|プラーナ|息)', r'\1', content, flags=re.DOTALL)
content = re.sub(r'###\s*セクション\d+:.*?\n\n?', '', content)
content = re.sub(r'\n{3,}', '\n\n', content)

# 保存
with open('scripts/5_アカシック台本', 'w', encoding='utf-8') as f:
    f.write(content)

print(f'✅ 台本5再生成完了: scripts/5_アカシック台本')
print(f'📊 文字数: {len(content)}文字')

# 即座に品質チェック
import subprocess
result = subprocess.run(
    ['python3', 'tools/script_quality_checker.py', 'scripts/5_アカシック台本'],
    capture_output=True,
    text=True
)
print(result.stderr)
print(result.stdout)
