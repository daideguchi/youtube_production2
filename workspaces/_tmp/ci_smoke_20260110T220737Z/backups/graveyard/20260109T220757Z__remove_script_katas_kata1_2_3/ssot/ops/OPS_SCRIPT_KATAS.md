# OPS_SCRIPT_KATAS — 台本「3つの型」を企画（Planning SoT）に落とし込み、生成を自動で型に沿わせる（SSOT）

目的:
- 6,000〜10,000字帯の長尺でも、トーン一定（落ち着き・丁寧・淡々）で「構造の飽き」を抑える。
- **台本の構成（型）を Planning SoT に固定**し、生成時に毎回ブレないようにする（再現性/量産向き）。
- 新規回の追加や複数エージェント並列でも迷わない（誰が見ても「この回はこの型」）。

正本（SoT）:
- Planning: `workspaces/planning/channels/CHxx.csv`
  - 追加カラム: `台本型`（任意だが運用上は推奨）
- 台本骨格（構成パターン/字数配分）: `ssot/ops/OPS_SCRIPT_PATTERNS.yaml`

適用（現時点）:
- まずは `CH01` と `CH02` に適用（= Planning に割当→生成がその型に沿う）。
- 他チャンネルへのスケールは「カラム追加 + 割当CLI実行」で同様に拡張できる。

---

## 1) Planning CSV のカラム仕様（確定）

- カラム名: `台本型`
- 値（この3つのどれか。大文字小文字は不問、空白は無視）
  - `kata1`（王道）: 結論→理由→具体例→再結論
  - `kata2`（3章）: 3つの扉（A=原理 / B=見分け / C=対処）
  - `kata3`（例回し）: 同じフレームで例を回す（状況→心→落とし穴→整え方）

運用メモ:
- このカラムは「本文生成を縛るための型」なので、タイトルと矛盾するテーマ誘導には使わない（タイトル=正）。
- 内容汚染（tag_mismatch 等）があっても `台本型` は **破棄しない**（汚染源ではないため）。

---

## 2) 自動割当（ランダム）ルール

方針:
- 「ランダム」は **再現性のある疑似ランダム** とする（= 同じ回を何度見ても型が変わらない）。
- Planning SoT に一度書いたら固定（再実行で勝手に変えない）。

割当方法（標準）:
- `script_id`（`CHxx-NNN`）+ seed からハッシュを作り、`kata1/kata2/kata3` に割り振る。
- 既に `台本型` が埋まっている行は触らない（上書きは明示フラグ時のみ）。

実行（CLI）:
```bash
python scripts/ops/planning_assign_script_kata.py --channel CH01 --apply
python scripts/ops/planning_assign_script_kata.py --channel CH02 --apply

# 上書きしたい場合（既存値を置換）
python scripts/ops/planning_assign_script_kata.py --channel CH01 --apply --overwrite
```

---

## 3) 生成（パイプライン）側の確定挙動

- `台本型` が指定されている場合、台本骨格（SSOT patterns）はその型に対応する `pattern_id` を優先採用する。
- 採用された骨格は `A_TEXT_PLAN_SUMMARY` としてアウトライン/章ブリーフ/章本文プロンプトに注入される。
- これにより、台本は **決められた流れ（型）に沿って自動で執筆**される。

注意:
- これは「本文に定型句を強制する」仕組みではない（Aテキスト禁則やチャンネル固有トーンを優先）。
- 目的は **構造（流れ）を固定**し、ズレ/反復/水増しを減らすこと。

