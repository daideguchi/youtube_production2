# LLM Router Configuration
# Defines providers, models, tiers, and task mappings.
#
# 2025-12-13:
# Default routing updated to OpenRouter low-cost chain (Rank A/B/C style).
# Azure remains optional/registered but is not selected by default tiers.

providers:
  azure:
    env_api_key: AZURE_OPENAI_API_KEY
    env_endpoint: AZURE_OPENAI_ENDPOINT
    default_api_version: "2024-10-01-preview"
  
  gemini:
    env_api_key: GEMINI_API_KEY
  
  openrouter:
    env_api_key: OPENROUTER_API_KEY
    base_url: "https://openrouter.ai/api/v1"

models:
  # --- Azure Models ---
  azure_gpt5_mini:
    provider: azure
    deployment: gpt-5-mini
    api_version: "2025-04-01-preview"
    capabilities:
      mode: chat
      reasoning: true
      json_mode: true
      max_completion_tokens: 128000
  
  # --- Gemini Models (Image Only) ---
  gemini_2_5_flash_image:
    provider: gemini
    model_name: gemini-2.5-flash-image
    capabilities:
      mode: image_generation
      vision: false
      json_mode: false

  # --- OpenRouter Models ---
  # Low-cost / high-quality general model (preferred for script writing)
  or_deepseek_v3_2_exp:
    provider: openrouter
    model_name: "deepseek/deepseek-v3.2-exp"
    capabilities:
      mode: chat
      reasoning: false
      json_mode: true
      max_tokens: 16384

  # Low-cost reasoning-ish fallback (distill)
  or_deepseek_r1_distill_qwen_32b:
    provider: openrouter
    model_name: "deepseek/deepseek-r1-distill-qwen-32b"
    capabilities:
      mode: chat
      reasoning: false
      json_mode: true
      max_tokens: 16384

  or_deepseek_r1:
    provider: openrouter
    model_name: "deepseek/deepseek-r1"
    capabilities:
      mode: chat
      reasoning: false
      json_mode: true
      max_tokens: 8192

  or_deepseek_r1_0528:
    provider: openrouter
    model_name: "deepseek/deepseek-r1-0528"
    capabilities:
      mode: chat
      reasoning: false
      json_mode: true
      max_tokens: 8192

  or_o3_mini:
    provider: openrouter
    model_name: "openai/o3-mini"
    capabilities:
      mode: chat
      reasoning: true
      json_mode: true
      max_tokens: 16384

  or_qwen_2_5_7b_instruct:
    provider: openrouter
    model_name: "qwen/qwen-2.5-7b-instruct"
    capabilities:
      mode: chat
      reasoning: false
      json_mode: false
      max_tokens: 8192

  or_hunyuan_a13b_instruct:
    provider: openrouter
    model_name: "tencent/hunyuan-a13b-instruct"
    capabilities:
      mode: chat
      reasoning: false
      json_mode: true
      max_tokens: 16384

  # Vision (image + text → text) — for thumbnail captioning
  or_qwen_2_5_vl_72b_instruct:
    provider: openrouter
    model_name: "qwen/qwen2.5-vl-72b-instruct"
    capabilities:
      mode: chat
      reasoning: false
      json_mode: true
      max_tokens: 8192

  or_gemma_3n_e2b_it_free:
    provider: openrouter
    model_name: "google/gemma-3n-e2b-it:free"
    capabilities:
      mode: chat
      reasoning: false
      json_mode: true
      max_tokens: 2048

  or_mistral_7b_instruct_free:
    provider: openrouter
    model_name: "mistralai/mistral-7b-instruct:free"
    capabilities:
      mode: chat
      reasoning: false
      json_mode: true
      max_tokens: 4096

tiers:
  # High intelligence, reasoning capable
  heavy_reasoning:
    - or_deepseek_v3_2_exp
    - or_deepseek_r1_distill_qwen_32b
    - or_deepseek_r1
    - or_deepseek_r1_0528
    # - or_o3_mini  # expensive; keep commented out by default
    # Keep Azure as optional fallback / A-B test; default is OpenRouter-first for cost.
    - azure_gpt5_mini
  
  # Standard tasks
  standard:
    - or_deepseek_v3_2_exp
    - or_hunyuan_a13b_instruct
    - or_qwen_2_5_7b_instruct
    - or_gemma_3n_e2b_it_free
    - azure_gpt5_mini

  # Cost effective
  cheap:
    - or_gemma_3n_e2b_it_free
    - or_hunyuan_a13b_instruct
    - or_mistral_7b_instruct_free
    - or_qwen_2_5_7b_instruct

  # Special purpose: Image generation ONLY
  image_gen:
    - gemini_2_5_flash_image

  # Special purpose: Vision captioning (image + text)
  vision_caption:
    - or_qwen_2_5_vl_72b_instruct

tasks:
  # --- Script Pipeline ---
  script_topic_research:
    tier: heavy_reasoning
    timeout: 300
    
  script_outline:
    tier: heavy_reasoning
    timeout: 180
    retry_policy: standard
    fallback_policy: tier_down

  script_chapter_brief:
    tier: heavy_reasoning
    timeout: 180

  script_chapter_draft:
    tier: heavy_reasoning
    timeout: 240
    retry_policy: extended

  script_chapter_review:
    tier: heavy_reasoning
    timeout: 180
  
  script_cta:
    tier: heavy_reasoning
    timeout: 180

  script_quality_check:
    tier: heavy_reasoning
    timeout: 300

  # A-text quality gate: Judge (diagnose) + Fixer (minimal rewrite)
  script_a_text_quality_judge:
    tier: heavy_reasoning
    timeout: 120
    defaults:
      response_format: "json_object"
      temperature: 0.2
      max_tokens: 1800

  script_a_text_quality_fix:
    tier: heavy_reasoning
    timeout: 240
    defaults:
      temperature: 0.4
      max_tokens: 16384

  # Semantic alignment: title/thumbnail promise ↔ A-text core message
  script_semantic_alignment_check:
    tier: standard
    timeout: 90
    defaults:
      response_format: "json_object"
      temperature: 0.2
      max_tokens: 1200

  script_semantic_alignment_fix:
    tier: heavy_reasoning
    timeout: 240
    defaults:
      temperature: 0.4
      max_tokens: 16384

  script_format:
    tier: standard
    timeout: 60

  # --- TTS Pipeline ---
  tts_annotate:
    tier: standard
    timeout: 30
    system_prompt_override: "You are a linguistic expert."

  tts_text_prepare:
    tier: standard
    timeout: 60

  tts_segment:
    tier: standard
    timeout: 30

  tts_pause:
    tier: standard
    timeout: 30

  tts_reading:
    tier: heavy_reasoning
    timeout: 60

  tts_natural_command:
    tier: standard
    timeout: 60
    system_prompt_override: "あなたは台本編集アシスタントです。指示をJSONで返してください。"
    defaults:
      response_format: "json_object"
      temperature: 0.3
      max_tokens: 800

  # --- Visual Pipeline ---
  visual_thumbnail_caption:
    tier: vision_caption
    timeout: 60
    system_prompt_override: "あなたはYouTubeサムネイルの要約者です。短く具体的に記述してください。"
    defaults:
      temperature: 0.2
      max_tokens: 300

  visual_section_plan:
    tier: heavy_reasoning
    timeout: 120

  # One-shot cue planning (segments → cue ranges + visual_focus)
  # Used to keep THINK MODE to a single pending task for srt2images.
  visual_image_cues_plan:
    tier: heavy_reasoning
    timeout: 180
    defaults:
      response_format: "json_object"

  visual_persona:
    tier: heavy_reasoning
    timeout: 60

  visual_prompt_refine:
    tier: heavy_reasoning
    timeout: 60

  visual_image_gen:
    tier: image_gen
  image_generation:
    tier: image_gen
    timeout: 60

  belt_generation:
    tier: standard
    timeout: 120
    defaults:
      response_format: "json_object"

  title_generation:
    tier: standard
    timeout: 60
